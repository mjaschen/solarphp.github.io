<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
        "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<!-- cached 2013-07-17 09:55:51 -->
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <title>Solar Framework for PHP 5</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" type="text/css" media="screen" href="/public/Proxima/Controller/Page/cssfw/tools.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="/public/Proxima/Controller/Page/cssfw/typo.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="/public/Proxima/Controller/Page/cssfw/forms.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="/public/Proxima/Controller/Page/cssfw/layout-navtop-1col.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="/public/Helios/Controller/Page/style.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="/public/Helios/App/Manual/style.css" />
</head>
<body id="manual-page">
    
    <div id="page">
        
        <div id="header" class="clearfix">
                        <div id="branding">
            </div><!-- end branding -->
            
            <div id="search">
                <script type="text/javascript"><!--
                google_ad_client = "pub-0303143248109581";
                /* 234x60, created 3/23/10 */
                google_ad_slot = "2131834509";
                google_ad_width = 234;
                google_ad_height = 60;
                //-->
                </script>
                <script type="text/javascript"
                src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
                </script>
            </div><!-- end search -->
            
                <div id="auth">
            </div>
        </div><!-- end header -->
        
        <div id="content" class="clearfix">
            
            <div id="main">
                <body>
    <div class="navheader">
      <table width="100%" summary="Navigation header">
        <tr>
          <th colspan="3" align="center">3.4. Fetching Data</th>
        </tr>
        <tr>
          <td width="20%" align="left"><a accesskey="p" href="model.catalog">Prev</a> </td>
          <th width="60%" align="center">Chapter 3. Working With Models</th>
          <td width="20%" align="right"> <a accesskey="n" href="model.results">Next</a></td>
        </tr>
      </table>
    </div>
    <div class="sect1" title="3.4. Fetching Data">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title" style="clear: both"><a id="model.fetch"></a>3.4. Fetching Data</h2>
          </div>
        </div>
      </div>
      <p>
        Once you have a model object, you can use it to fetch data from the
        table it represents.
    </p>
      <div class="sect2" title="3.4.1. Fetch Methods">
        <div class="titlepage">
          <div>
            <div>
              <h3 class="title"><a id="model.fetch.methods"></a>3.4.1. Fetch Methods</h3>
            </div>
          </div>
        </div>
        <div class="variablelist">
          <dl>
            <dt>
              <span class="term">
                <code class="literal">fetch()</code>
              </span>
            </dt>
            <dd>
              <p>
                    Fetches a record or collection object by primary key value(s).
                </p>
            </dd>
            <dt>
              <span class="term">
                <code class="literal">fetchAll()</code>
              </span>
            </dt>
            <dd>
              <p>
                    Fetches a collection object (keyed sequentially) populated
                    with record objects.
                </p>
            </dd>
            <dt>
              <span class="term">
                <code class="literal">fetchAllAsArray()</code>
              </span>
            </dt>
            <dd>
              <p>
                    The same as <code class="literal">fetchAll()</code>, except the result is
                    a sequential array of row arrays, instead of a
                    collection object.
                </p>
            </dd>
            <dt>
              <span class="term">
                <code class="literal">fetchAssoc()</code>
              </span>
            </dt>
            <dd>
              <p>
                    Similar to <code class="literal">fetchAll()</code>, this fetches a collection object
                    using associative keys, populated with record objects. The
                    associative keys are taken from the first column of the
                    results.
                </p>
            </dd>
            <dt>
              <span class="term">
                <code class="literal">fetchAssocAsArray()</code>
              </span>
            </dt>
            <dd>
              <p>
                    The same as <code class="literal">fetchAssoc()</code>, except the result is
                    an associative array of row arrays, instead of a
                    collection object.
                </p>
            </dd>
            <dt>
              <span class="term">
                <code class="literal">fetchCol()</code>
              </span>
            </dt>
            <dd>
              <p>
                    Fetches a sequential array populated with only the first
                    column of data.
                </p>
            </dd>
            <dt>
              <span class="term">
                <code class="literal">fetchOne()</code>
              </span>
            </dt>
            <dd>
              <p>
                    Fetches a single record object.
                </p>
            </dd>
            <dt>
              <span class="term">
                <code class="literal">fetchOneAsArray()</code>
              </span>
            </dt>
            <dd>
              <p>
                    Similar to <code class="literal">fetchOne()</code>, except the result is an 
                    associative array where the key is the column name
                    and the value is the column value.
                </p>
            </dd>
            <dt>
              <span class="term">
                <code class="literal">fetchPairs()</code>
              </span>
            </dt>
            <dd>
              <p>
                    Fetches an associative array of key-value pairs where
                    the first column is the key and the second column is
                    the value.
                </p>
            </dd>
            <dt>
              <span class="term">
                <code class="literal">fetchValue()</code>
              </span>
            </dt>
            <dd>
              <p>
                    Returns a single value; i.e., the first column of the
                    first row.
                </p>
            </dd>
          </dl>
        </div>
      </div>
      <div class="sect2" title="3.4.2. Fetch Parameters">
        <div class="titlepage">
          <div>
            <div>
              <h3 class="title"><a id="model.fetch.params"></a>3.4.2. Fetch Parameters</h3>
            </div>
          </div>
        </div>
        <p>
            For the <code class="literal">fetch()</code> method, the only
            parameter is a primary key value (or an array of such values).
            
            </p>
        <pre class="programlisting"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php
</span><span style="color: #FF8000">// a single blog record, blog.id = 1
</span><span style="color: #0000BB">$item </span><span style="color: #007700">= </span><span style="color: #0000BB">$model</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">blogs</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetch</span><span style="color: #007700">(</span><span style="color: #0000BB">1</span><span style="color: #007700">);

</span><span style="color: #FF8000">// a collection of blog records
</span><span style="color: #0000BB">$list </span><span style="color: #007700">= </span><span style="color: #0000BB">$model</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">blogs</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetch</span><span style="color: #007700">(array(</span><span style="color: #0000BB">1</span><span style="color: #007700">, </span><span style="color: #0000BB">2</span><span style="color: #007700">, </span><span style="color: #0000BB">5</span><span style="color: #007700">));</span></span></code></pre>
        <p>
        </p>
        <p>
            All the other fetch methods take a series of parameters
            that get translated to SELECT clauses. The parameters are
            expressed as an associative array.
            
            </p>
        <pre class="programlisting"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php
$fetch </span><span style="color: #007700">= array(
    </span><span style="color: #FF8000">// SELECT ... FROM blogs AS zim
    </span><span style="color: #DD0000">'alias' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'zim'</span><span style="color: #007700">,
    
    </span><span style="color: #FF8000">// select these columns
    </span><span style="color: #DD0000">'cols' </span><span style="color: #007700">=&gt; array(</span><span style="color: #DD0000">'id'</span><span style="color: #007700">, </span><span style="color: #DD0000">'foo'</span><span style="color: #007700">, </span><span style="color: #DD0000">'bar'</span><span style="color: #007700">, </span><span style="color: #DD0000">'SUM(baz) AS total'</span><span style="color: #007700">),
    
    </span><span style="color: #FF8000">// WHERE conditions
    </span><span style="color: #DD0000">'where' </span><span style="color: #007700">=&gt; array(
        </span><span style="color: #DD0000">'foo = :foo'</span><span style="color: #007700">,
        </span><span style="color: #DD0000">'dib IN (?)' </span><span style="color: #007700">=&gt; array(</span><span style="color: #0000BB">1</span><span style="color: #007700">, </span><span style="color: #0000BB">2</span><span style="color: #007700">, </span><span style="color: #0000BB">5</span><span style="color: #007700">),
        </span><span style="color: #DD0000">'OR bar &gt; ?' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$bar</span><span style="color: #007700">,
    ),
    
    </span><span style="color: #FF8000">// GROUP BY columns
    </span><span style="color: #DD0000">'group' </span><span style="color: #007700">=&gt; array(</span><span style="color: #DD0000">'zim.id'</span><span style="color: #007700">),
    
    </span><span style="color: #FF8000">// HAVING conditions
    </span><span style="color: #DD0000">'having' </span><span style="color: #007700">=&gt; array(
        </span><span style="color: #DD0000">'total &gt; ?' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$total</span><span style="color: #007700">,
    ),
    
    </span><span style="color: #FF8000">// ORDER BY columns
    </span><span style="color: #DD0000">'order' </span><span style="color: #007700">=&gt; array(</span><span style="color: #DD0000">'total'</span><span style="color: #007700">),
    
    </span><span style="color: #FF8000">// you can use regular LIMITs ...
    </span><span style="color: #DD0000">'limit' </span><span style="color: #007700">=&gt; array(</span><span style="color: #0000BB">$count</span><span style="color: #007700">, </span><span style="color: #0000BB">$offset</span><span style="color: #007700">),
    
    </span><span style="color: #FF8000">// ... or let the model calculate a page-based LIMIT
    </span><span style="color: #DD0000">'page'   </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$page_number</span><span style="color: #007700">,
    </span><span style="color: #DD0000">'paging' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$rows_per_page</span><span style="color: #007700">,
    
    </span><span style="color: #FF8000">// do a followup query without limits to get a page count
    </span><span style="color: #DD0000">'count_pages' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true</span><span style="color: #007700">,
    
    </span><span style="color: #FF8000">// bind these placeholder values to the query
    </span><span style="color: #DD0000">'bind' </span><span style="color: #007700">=&gt; array(</span><span style="color: #DD0000">'bar' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$bar</span><span style="color: #007700">),
);

</span><span style="color: #FF8000">// fetch a collection using the fetch params
</span><span style="color: #0000BB">$list </span><span style="color: #007700">= </span><span style="color: #0000BB">$model</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">blogs</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchAll</span><span style="color: #007700">(</span><span style="color: #0000BB">$fetch</span><span style="color: #007700">);</span></span></code></pre>
        <p>
        </p>
        <div class="variablelist">
          <dl>
            <dt>
              <span class="term">
                <code class="literal">alias</code>
              </span>
            </dt>
            <dd>
              <p>
                    Normally, the model will use the table name without an alias
                    in the SELECT query it generates. However, you can use this
                    to specify an alias. In the above example, this would
                    generate <code class="literal">FROM blogs AS zim</code>.
                </p>
            </dd>
            <dt>
              <span class="term">
                <code class="literal">cols</code>
              </span>
            </dt>
            <dd>
              <p>
                    Normally, the model will fetch all table columns. You
                    can use this to specify which columns to select,
                    including computed columns.
                </p>
            </dd>
            <dt>
              <span class="term">
                <code class="literal">where</code>
              </span>
            </dt>
            <dd>
              <p>
                    This is an array of conditions for the WHERE clause. The
                    elements each take one of two forms. The first is a single
                    value passed literally as the condition. The second is a
                    key-value pair where the key has one or more
                    <code class="literal">?</code> placeholders in it; the value is then
                    quoted against SQL injection and placed into the
                    condition immediately.
                </p>
            </dd>
            <dt>
              <span class="term">
                <code class="literal">group</code>
              </span>
            </dt>
            <dd>
              <p>
                    Indicates a GROUP BY clause using these columns.
                </p>
            </dd>
            <dt>
              <span class="term">
                <code class="literal">having</code>
              </span>
            </dt>
            <dd>
              <p>
                    As with <code class="literal">where</code>, this is an array of
                    conditions for the HAVING clause.
                </p>
            </dd>
            <dt>
              <span class="term">
                <code class="literal">order</code>
              </span>
            </dt>
            <dd>
              <p>
                    Indicates an ORDER BY clause using these columns.
                </p>
            </dd>
            <dt>
              <span class="term">
                <code class="literal">limit</code>
              </span>
            </dt>
            <dd>
              <p>
                    This can be an integer indicating a LIMIT count, or it
                    can be an array of two elements, indicating a LIMIT count
                    and offset.  This parameter overrides the <code class="literal">page</code>
                    and <code class="literal">paging</code> values.
                </p>
            </dd>
            <dt>
              <span class="term">
                <code class="literal">page</code>
              </span>
            </dt>
            <dd>
              <p>
                    When combined with <code class="literal">paging</code>, this will
                    fetch the indicated page-number of the result set.
                </p>
            </dd>
            <dt>
              <span class="term">
                <code class="literal">paging</code>
              </span>
            </dt>
            <dd>
              <p>
                    Indicates to <code class="literal">page</code> how many result
                    rows per page it should use when calculating the page
                    number.
                </p>
            </dd>
            <dt>
              <span class="term">
                <code class="literal">count_pages</code>
              </span>
            </dt>
            <dd>
              <p>
                    When set to <code class="literal">true</code>, this will cause a
                    second query to occur after the fetch. The second query
                    will perform a COUNT() using the same parameters, but
                    without fetching any data and without a limit. It will
                    retain the count of rows, count of pages, first and last
                    page numbers, and other pagination data in the collection
                    object.  Unless you are using pagination, you generally
                    should not ask for <code class="literal">count_pages</code>.
                </p>
            </dd>
            <dt>
              <span class="term">
                <code class="literal">bind</code>
              </span>
            </dt>
            <dd>
              <p>
                    This is an array of key-value pairs to bind to named
                    placeholders in the resulting SELECT statement.
                </p>
            </dd>
          </dl>
        </div>
      </div>
      <div class="sect2" title="3.4.3. Magic Fetch Methods">
        <div class="titlepage">
          <div>
            <div>
              <h3 class="title"><a id="model.fetch.magic"></a>3.4.3. Magic Fetch Methods</h3>
            </div>
          </div>
        </div>
        <p>
            The model objects allow a shorthand form of fetching
            records and collections by using the magic <code class="literal">__call()</code>
            method to dynamically interpret the incoming method name and
            convert it to a series of WHERE clauses for you.
        </p>
        <p>
            There are two recgonized magic methods:
            <code class="literal">fetchAllBy...()</code> and
            <code class="literal">fetchOneBy...()</code>. The remaining words in the
            method name are treated as column names (where
            <code class="literal">column_name</code> is recognzed as
            <code class="literal">ColumnName</code>) separated by
            <code class="literal">And</code>.  The method params are equality values
            for the columns in the method name; a final trailing argument
            of additional fetch parameters is also recognized.
        </p>
        <pre class="programlisting"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php
</span><span style="color: #FF8000">// fetch a single blog record WHERE foo = 'bar'
</span><span style="color: #0000BB">$item </span><span style="color: #007700">= </span><span style="color: #0000BB">$model</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">blogs</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchOneByFoo</span><span style="color: #007700">(</span><span style="color: #DD0000">'bar'</span><span style="color: #007700">);

</span><span style="color: #FF8000">// fetch a collection of blogs WHERE foo = 'bar' AND baz = 'dib'
</span><span style="color: #0000BB">$list </span><span style="color: #007700">= </span><span style="color: #0000BB">$model</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">blogs</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchAllByFooAndBaz</span><span style="color: #007700">(</span><span style="color: #DD0000">'bar'</span><span style="color: #007700">, </span><span style="color: #DD0000">'dib'</span><span style="color: #007700">);

</span><span style="color: #FF8000">// fetch a collection of blogs WHERE zim = 'gir',
// with additional parameters
</span><span style="color: #0000BB">$params </span><span style="color: #007700">= array(</span><span style="color: #DD0000">'order' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'id DESC'</span><span style="color: #007700">);
</span><span style="color: #0000BB">$list </span><span style="color: #007700">= </span><span style="color: #0000BB">$model</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">blogs</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetchAllByZim</span><span style="color: #007700">(</span><span style="color: #DD0000">'gir'</span><span style="color: #007700">, </span><span style="color: #0000BB">$params</span><span style="color: #007700">);</span></span></code></pre>
        <div class="note" title="Note">
          <table border="0" summary="Note">
            <tr>
              <td rowspan="2" align="center" valign="top" width="25">
                <img alt="[Note]" src="images/note.png" />
              </td>
              <th align="left">Note</th>
            </tr>
            <tr>
              <td align="left" valign="top">
                <p>
            The magic fetch methods are comparatively slow.  If you find
            yourself using a particular fetch over and over, consider
            writing a method on your model object for that fetch.
        </p>
              </td>
            </tr>
          </table>
        </div>
      </div>
    </div>
    <div class="navfooter">
      <table width="100%" summary="Navigation footer">
        <tr>
          <td width="40%" align="left"><a accesskey="p" href="model.catalog">Prev</a> </td>
          <td width="20%" align="center">
            <a accesskey="u" href="model">Up</a>
          </td>
          <td width="40%" align="right"> <a accesskey="n" href="model.results">Next</a></td>
        </tr>
        <tr>
          <td width="40%" align="left" valign="top">3.3. The Model Catalog </td>
          <td width="20%" align="center">
            <a accesskey="h" href="index">Home</a>
          </td>
          <td width="40%" align="right" valign="top"> 3.5. Records and Collections</td>
        </tr>
      </table>
    </div>
    <div xmlns="" class="revinfo"></div>
  </body>                <hr />
            </div><!-- end main content -->
            
            <div id="sub">
                                <hr />
            </div><!-- end sub content -->
            
            <div id="local">
                <h2 class="accessibility">Local</h2>
            </div><!--  end local nav -->
            
            <div id="nav">
                <h2 class="accessibility">Navigation</h2>
<ul class="clearfix">
    <li><a href="/">Home</a></li>
<li><a href="/project">Project</a></li>
<li><a href="/apidoc/package.index">Packages</a></li>
<li><a href="/apidoc/class.index">Classes</a></li>
<li class="active"><a href="/manual">Manual</a></li>
    <li><a href="https://github.com/solarphp/core/issues">Bugs</a></li>
</ul>
            </div><!-- end main nav -->
            
        </div><!-- end content -->
        
        <div id="footer" class="clearfix">
            <p style="float: left;">
    Copyright &copy; 2005-2013, <a href="mailto:pmjones@solarphp.com">Paul M. Jones</a> and other contributors.<br />
    Logo Design by <a href="http://wine-by-benito.blogspot.com/">Ben Carter</a>,
    Site Design by <a href="http://mattbrett.com/design">Matt Brett</a>.
</p>
<p style="float: right;">
<!-- Start of StatCounter Code for Default Guide -->
<script type="text/javascript">
var sc_project=9117593; 
var sc_invisible=0; 
var sc_security="067d59a6"; 
var scJsHost = (("https:" == document.location.protocol) ?
"https://secure." : "http://www.");
document.write("<sc"+"ript type='text/javascript' src='" +
scJsHost+
"statcounter.com/counter/counter.js'></"+"script>");
</script>
<noscript><div class="statcounter"><a title="web stats"
href="http://statcounter.com/" target="_blank"><img
class="statcounter"
src="http://c.statcounter.com/9117593/0/067d59a6/0/"
alt="web stats"></a></div></noscript>
<!-- End of StatCounter Code for Default Guide --></p>
        </div><!-- end footer -->
        
    </div><!-- end page -->
    
    <div id="extra1">&nbsp;</div>
    <div id="extra2">&nbsp;</div>
    
</body>

</html>
